<script src="../bclib.js"></script>
<script src="../bclib-staging.js"></script>

<canvas id="thefonz" width="800" height="600"></canvas>


<script>

let fonz = document.getElementById('thefonz');
let ctx = fonz.getContext('2d');

// just to confirm I can draw *something*
ctx.fillRect(100,100,10,10);

// testing w "randomly selected" tile

let url = 'http://test.barrycarter.info/bc-mytile4.pl?/2/2/3.png';

// url = 'http://ws.terramapadventure.com/CLIMATE/2/1/0.png'

fetch(url).then(function (response) {
    response.blob().then(function (b) {
	console.log('B', b);
	let blobURL = URL.createObjectURL(b);
	console.log('blobURL', blobURL);
	let i = new Image();
	i.src = blobURL;
	//	i.src = url;
	//	ctx.drawImage(i, 105, 105);
	//	console.log(URLCache.get(url));
	//	i.src = URLCache.get(url);
	console.log('i', i);
	i.onload = function() {ctx.drawImage(i, 105, 105);}
      })
      })





die_the_bread();

// can I draw my own "slippy tiles" for testing

let canvas = document.createElement('canvas314');

canvas314.width = 256;
canvas314.height = 256;

// let ctx = canvas314.getContext('2d');

let png2 = canvas314.toDataURL("image/png");

die_testing();

let png = 'iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAElBMVEVAygOW4HdEvwQ8zQA9ywRBygBw60gpAAABAUlEQVR4nO3PARGAMAwAsQKdf8vo+F3iIPO8387ZPXMrwz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+wz7DPsM+w7wfv64YnTVjj7gAAAAASUVORK5CYII=';


let data = fetch('http://test.barrycarter.info/bc-cors-test.pl').then
   (function (x) {return x.arrayBuffer();}).then
   (function (y) {datahandle(new DataView(y));});

function datahandle(z) {
  //  for (let i=0 ; i<z.byteLength; i++) {
  //    console.log(i, z.getUint8(i));
  //  }
}

let myImageData = ctx.createImageData(fonz.width, fonz.height);

for (i=0; i < myImageData.data.length; i++) {
  myImageData.data[i] = Math.floor(Math.random()*256);
 }

ctx.putImageData(myImageData, 0, 0);


// this does not appear to work

// ctx.globalAlpha = 0.0001;



// ctx.putImageData(png, 0, 0);


// for (i=0; i<=240000; i++) {
//  x = Math.floor(Math.random()*1600);
//  y = Math.floor(Math.random()*900);
//  ctx.fillRect(x,y,1,1);
// }


console.log(myImageData);



</script>
