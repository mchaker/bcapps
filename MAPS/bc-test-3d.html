<script src="../bclib.js"></script>
<script src="../bclib-staging.js"></script>
<script src="bc-osmtilecache.js"></script>
<script src="../THREE.JS/three.min.js"></script>
<div id="container"></div>

<script>

// Create renderer, camera, scne
let renderer = new THREE.WebGLRenderer();
let camera = new THREE.PerspectiveCamera(36);
let scene = new THREE.Scene();

// Put renderer in container above
document.querySelector('#container').appendChild(renderer.domElement);

// Set rendeer scene, add camera

camera.position.z = 3.5;

// The camera defaults to looking down the -Z axis with +Y up

scene.add(camera);
renderer.setSize(700, 700);

// Attach the renderer-supplied DOM element.
container.appendChild(renderer.domElement);

// create sphere shards for zoom level z

let shard = [];

let z = 4;

for (let i=0; i<2**z; i++) {
  shard[i] = [];
  for (let j=0; j<2**z; j++) {

    let nwtile = tile2LngLat({z: z, x: i, y: j, projection: 1});
    let setile = tile2LngLat({z: z, x: i+1, y: j+1, projection: 1});

    // real latitude -> Three.js theta param: 90 -> 0, 0 -> 90, -90 -> 180
    nwtile.theta = 90-nwtile.lat;
    setile.theta = 90-setile.lat;

//    console.log("TILES", i, j, nwtile, setile);
//  console.log("PARAMS", nwtile.lng*Degree, (setile.lng-nwtile.lng)*Degree, nwtile.theta*Degree, (setile.theta-nwtile.theta)*Degree);

    shard[i][j] = new THREE.Mesh(new THREE.SphereGeometry(1, 10, 10, 
                    nwtile.lng*Degree, (setile.lng-nwtile.lng)*Degree,
                    nwtile.theta*Degree, (setile.theta-nwtile.theta)*Degree),
		    new THREE.MeshBasicMaterial( {color: 0xffffff} ));

   // put the correct slippy tile on it
   shard[i][j].material.map = THREE.ImageUtils.loadTexture(URLCache.cache[`https://tile.openstreetmap.org/${z}/${i}/${j}.png`]);

    scene.add(shard[i][j]);
  }
 }

function update () {

 camera.position.x -= 0.01;
 camera.lookAt(new THREE.Vector3(0, 0, 0));

 renderer.render(scene, camera);
 requestAnimationFrame(update);
}

// Schedule the first frame.
requestAnimationFrame(update);

</script>
